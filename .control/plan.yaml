version: 1
sprints:
  - id: 1
    name: "Core FSM"
    tasks:
      - id: "S1-T1"
        title: "Implement FSM core service"
        done_condition: "SessionTimeoutService implements IDLE→COUNTDOWN→WARN→EXPIRED with commands"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/session-timeout.service.spec.ts"
      - id: "S1-T2"
        title: "Config defaults, validation, and logging"
        done_condition: "Defaults + validation exported and validated via unit specs"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/defaults.ts"
          - "packages/ng2-idle-timeout/src/lib/validation.ts"
          - "packages/ng2-idle-timeout/src/lib/utils/logging.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/session-timeout.service.spec.ts"
      - id: "S1-T3"
        title: "Unit tests & docs snapshot"
        done_condition: "Core Jest suite green and README Sprint 1 note present"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.spec.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/session-timeout.service.spec.ts"
  - id: 2
    name: "Activity & Persistence"
    tasks:
      - id: "S2-T1"
        title: "DOM activity detectors"
        done_condition: "DOM interactions reset idle via zoneless-safe listeners"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/activity-dom.service.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/activity-dom.service.spec.ts"
      - id: "S2-T2"
        title: "Router and storage persistence"
        done_condition: "Router events configurable and idle state persisted in localStorage"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/activity-router.service.ts"
          - "packages/ng2-idle-timeout/src/lib/utils/storage.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/activity-router.service.spec.ts"
      - id: "S2-T3"
        title: "Configuration wiring & docs"
        done_condition: "Open-tab inherit behaviour, documentation updated"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/defaults.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=ng2-idle-timeout"
  - id: 3
    name: "Cross-Tab Sync"
    tasks:
      - id: "S3-T1"
        title: "Broadcast channel sync"
        done_condition: "Cross-tab extend/expire propagated via BroadcastChannel with fallback"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/utils/broadcast-channel.ts"
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/session-timeout-cross-tab.spec.ts"
      - id: "S3-T2"
        title: "Leader election"
        done_condition: "LeaderElectionService manages primary tab duties with tests"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/leader-election.service.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/leader-election.service.spec.ts"
      - id: "S3-T3"
        title: "Multi-tab test coverage & docs"
        done_condition: "Jest multi-tab suite and README multi-tab recipe present"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.spec.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/session-timeout-cross-tab.spec.ts"
  - id: 4
    name: "HTTP Policy Plumbing"
    tasks:
      - id: "S4-T1"
        title: "HTTP interceptor allowlist"
        done_condition: "Allowlist strategy resets idle for matching requests"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/interceptors/session-activity-http.interceptor.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/interceptors/session-activity-http.interceptor.spec.ts"
      - id: "S4-T2"
        title: "Header flag & cooldown handling"
        done_condition: "Header/context driven activity with cooldown timers"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/interceptors/session-activity-http.interceptor.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/interceptors/session-activity-http.interceptor.spec.ts"
      - id: "S4-T3"
        title: "Integration tests & docs"
        done_condition: "Combined user+HTTP policy tests and README HTTP policy section"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.spec.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=ng2-idle-timeout"
  - id: 5
    name: "Server Time & Overrides"
    tasks:
      - id: "S5-T1"
        title: "Server time offset fetcher"
        done_condition: "TimeSourceService fetches and applies server offset with retry/backoff"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/time-source.service.ts"
          - "packages/ng2-idle-timeout/src/lib/services/server-time.service.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/services/time-source.service.spec.ts"
      - id: "S5-T2"
        title: "Per-route overrides & guard"
        done_condition: "SessionExpiredGuard honours per-route config overrides"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/guards/session-expired.guard.ts"
        tests:
          - "npm run test --workspace=ng2-idle-timeout -- src/lib/guards/session-expired.guard.spec.ts"
      - id: "S5-T3"
        title: "Pause/resume enhancements & docs"
        done_condition: "Pause/resume integrated with server time and docs updated"
        outputs:
          - "packages/ng2-idle-timeout/src/lib/services/session-timeout.service.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=ng2-idle-timeout"
  - id: 6
    name: "Packaging & CI"
    tasks:
      - id: "S6-T1"
        title: "ng-packagr packaging & barrel review"
        done_condition: "ng-packagr build succeeds and public API validated"
        outputs:
          - "packages/ng2-idle-timeout/ng-package.json"
          - "packages/ng2-idle-timeout/src/public-api.ts"
        tests:
          - "npm run build --workspace=ng2-idle-timeout"
      - id: "S6-T2"
        title: "Schematics & README guidance"
        done_condition: "ng add schematic wires providers; README recipes updated"
        outputs:
          - "schematics/ng-add/index.ts"
          - "README.md"
        tests:
          - "npm run test --workspace=schematics/ng-add"
      - id: "S6-T3"
        title: "CI matrix & demo examples"
        done_condition: "GitHub Actions matrix for Angular 16-20 and demo updated"
        outputs:
          - ".github/workflows/ci.yml"
          - "apps/demo/README.md"
        tests:
          - "npm run test --workspace=demo-app"
  - id: 7
    name: "Documentation & Playground"
    tasks:
      - id: "S7-T1"
        title: "Documentation route & layout"
        done_condition: "Docs route renders usage guides with PrimeNG styling"
        outputs:
          - "apps/experience/src/app/docs/docs.component.ts"
          - "apps/experience/src/app/docs/docs.component.html"
        tests:
          - "npm run demo:test"
      - id: "S7-T2"
        title: "Interactive playground"
        done_condition: "Live config controls drive SessionTimeoutService state"
        outputs:
          - "apps/experience/src/app/playground/playground.component.ts"
          - "apps/experience/src/app/playground/playground.component.html"
        tests:
          - "npm run demo:test"
      - id: "S7-T3"
        title: "Scripts & verification"
        done_condition: "Demo app build/test scripts documented and passing"
        outputs:
          - "package.json"
          - "README.md"
          - "RELEASE_NOTES.md"
        tests:
          - "npm run demo:build"
          - "npm run demo:test"
