<section class="page-hero">
  <div class="hero-copy">
    <p class="eyebrow">{{ craftedByLabel }}</p>
    <h1>ng2-idle-timeout Reference</h1>
    <p class="lead">
      These docs combine architectural guidance with hands-on recipes so your Angular app can orchestrate idle,
      countdown, and expiry transitions across every tab. Explore the playground in parallel to validate scenarios
      end-to-end.
    </p>
    <div class="hero-actions">
      <a class="btn btn-primary rounded-pill" href="#quick-start">Get started</a>
      <a class="btn btn-outline-primary rounded-pill" routerLink="/playground">Open playground</a>
    </div>
    <div class="badge-strip">
      <span *ngFor="let badge of heroBadges" class="badge bg-light text-dark border">{{ badge }}</span>
    </div>
  </div>
  <div class="hero-card card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">What you'll cover</h5>
      <ul class="list-unstyled">
        <li><i class="bi bi-check-circle-fill text-success"></i> End-to-end architecture, state machine, and timing anatomy.</li>
        <li><i class="bi bi-check-circle-fill text-success"></i> Configuration cheat sheets with copy-paste snippets.</li>
        <li><i class="bi bi-check-circle-fill text-success"></i> Service APIs, hooks, and integration patterns ready for production.</li>
      </ul>
    </div>
  </div>
</section>

<hr class="section-divider" />

<section class="docs-content">
  <article class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">On this page</h2>
      <nav>
        <ul class="nav-list">
          <li *ngFor="let link of sectionNav">
            <a [attr.href]="link.href">{{ link.label }}</a>
          </li>
        </ul>
      </nav>
    </div>
  </article>

  <article id="overview" class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">1. Overview & Concepts</h2>
      <p>Key differentiators that make the engine suitable for enterprise timeout policies:</p>
      <ul class="list-bullet">
        <li *ngFor="let highlight of overviewHighlights">{{ highlight }}</li>
      </ul>
      <div class="code-block">
        <pre><code>{{ architectureDiagram }}</code></pre>
      </div>
      <table class="table table-sm compat-table">
        <thead>
          <tr>
            <th>Package</th>
            <th>Angular</th>
            <th>Node</th>
            <th>RxJS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of compatibilityMatrix">
            <th scope="row">{{ row.package }}</th>
            <td><code>{{ row.angular }}</code></td>
            <td><code>{{ row.node }}</code></td>
            <td><code>{{ row.rxjs }}</code></td>
          </tr>
        </tbody>
      </table>
    </div>
  </article>

  <article id="quick-start" class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">2. Quick Start</h2>
      <p>Install the package, define shared providers, and register them where you bootstrap the app.</p>
      <p class="helper">No <code>app.config.ts</code>? Wire the providers directly in <code>main.ts</code> (standalone) or inside <code>AppModule</code>.</p>
      <div class="command-list">
        <div *ngFor="let cmd of installCommands" class="command">
          <code>{{ cmd }}</code>
          <button type="button" class="btn btn-sm btn-outline-secondary" (click)="copy(cmd)">
            <i class="bi bi-clipboard"></i>
            Copy
          </button>
        </div>
      </div>
      <h3 class="section-heading">Define shared providers</h3>
      <div class="code-block">
        <pre><code>{{ providerSnippet }}</code></pre>
      </div>
      <h3 class="section-heading">Register providers with your bootstrap</h3>
      <p><strong>Standalone bootstrap:</strong> <code>main.ts</code></p>
      <div class="code-block">
        <pre><code>{{ standaloneBootstrapSnippet }}</code></pre>
      </div>
      <p><strong>NgModule bootstrap:</strong> <code>app.module.ts</code></p>
      <div class="code-block">
        <pre><code>{{ ngModuleBootstrapSnippet }}</code></pre>
      </div>
      <p class="helper">To opt into HTTP activity helpers, add <code>provideHttpClient(withInterceptorsFromDi())</code> (standalone) or import <code>HttpClientModule</code> and provide <code>SessionActivityHttpInterceptor</code>.</p>
      <h3 class="section-heading">Start the engine</h3>
      <div class="code-block">
        <pre><code>{{ startSnippet }}</code></pre>
      </div>
      <p class="helper">Call <code>sessionTimeout.start()</code> once shell-level services are initialised to persist the first snapshot.</p>
      <h3 class="section-heading">Sample usage (inject the service)</h3>
      <div class="code-block">
        <pre><code>{{ sampleComponentSnippet }}</code></pre>
      </div>
      <div class="code-block">
        <pre><code>{{ sampleTemplateSnippet }}</code></pre>
      </div>
      <p class="helper">Expose whichever style suits your component: signals (e.g. <code>state()</code>, <code>idleRemainingMs()</code>) or their mirrored streams (e.g. <code>state$</code>, <code>idleRemainingMs$</code>) plus <code>events$</code> after calling <code>start()</code>.</p>
      <p class="helper">Spin up the docs and playground with <code>npm run demo:start</code> at <code>http://localhost:4200</code> to validate scenarios end-to-end.</p>
    </div>
  </article>

  <article id="configuration" class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">3. Configuration Guide</h2>
      <p>Understand the knobs that shape idle and countdown behaviour.</p>
      <table class="table table-sm config-table">
        <thead>
          <tr>
            <th>Key</th>
            <th>Default</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let option of configOptions">
            <th scope="row"><code>{{ option.key }}</code></th>
            <td><code>{{ option.defaultValue }}</code></td>
            <td>{{ option.description }}</td>
          </tr>
        </tbody>
      </table>
      <p class="helper">
        Disable <code>resetOnWarningActivity</code> when warnings should require manual acknowledgementâ€”suppressed events still surface on
        <code>activity$</code> via <code>resetSuppressed</code> and <code>resetSuppressedReason</code> metadata so analytics and UIs can explain why the timer did not reset.
      </p>
      <div class="code-block">
        <pre><code>{{ timingDiagram }}</code></pre>
      </div>
      <div class="preset-grid">
        <div class="preset" *ngFor="let preset of timingPresets">
          <h4>{{ preset.name }}</h4>
          <p>{{ preset.description }}</p>
        </div>
      </div>
      <h3 class="section-heading">Shared state coordination</h3>
      <p>Leader coordination is enforced in versions 0.3.4 and later. Distributed mode documentation is retained below for historical reference only.</p>
      <ul class="list-bullet">
        <li><code>leader</code> keeps a single writer that persists snapshots and rebroadcasts updates.</li>
        <li><em>Distributed mode was removed after field issues; legacy snapshots are still normalised for compatibility.</em></li>
      </ul>

      <h3 class="section-heading">Shared state metadata</h3>
      <p>Snapshots include metadata so peers can reason about ordering, reconcile after crashes, and diagnose issues:</p>
      <ul class="list-bullet">
        <li><code>revision</code> and <code>logicalClock</code> track monotonic progress for each snapshot.</li>
        <li><code>writerId</code> identifies which tab created the update.</li>
        <li><code>operation</code> distinguishes activity resets, extends, pauses, resumes, config changes, and expiries.</li>
        <li><code>causalityToken</code> lets retries and expect-reply flows collapse duplicate broadcasts.</li>
      </ul>
      <p class="helper">Schema version 3 automatically upgrades older persisted payloads, but clearing storage during rollout avoids stale Lamport clocks.</p>
    </div>
  </article>

  <article id="api" class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">4. Service & API Reference</h2>
      <h3 class="section-heading">SessionTimeoutService methods</h3>
      <table class="table table-sm service-table">
        <thead>
          <tr>
            <th>Method</th>
            <th>Signature</th>
            <th>Purpose</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let method of serviceMethods">
            <th scope="row">{{ method.name }}</th>
            <td><code>{{ method.signature }}</code></td>
            <td>{{ method.description }}</td>
          </tr>
        </tbody>
      </table>

      <h3 class="section-heading">Signals & streams</h3>
      <table class="table table-sm signal-table">
        <thead>
          <tr>
            <th>Signal</th>
            <th>Observable</th>
            <th>Type</th>
            <th>Emits</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let signal of signalRows">
            <th scope="row">{{ signal.signal }}</th>
            <td><code>{{ signal.observable }}</code></td>
            <td><code>{{ signal.type }}</code></td>
            <td>{{ signal.description }}</td>
          </tr>
        </tbody>
      </table>
      <p class="helper"><code>remainingMs$</code> reuses <code>totalRemainingMs$</code> under the hood so legacy consumers keep working without duplicate emissions.</p>

      <h3 class="section-heading">Tokens, hooks, supporting providers</h3>
      <table class="table table-sm token-table">
        <thead>
          <tr>
            <th>Token / helper</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let token of tokenRows">
            <th scope="row">{{ token.name }}</th>
            <td><code>{{ token.type }}</code></td>
            <td>{{ token.description }}</td>
          </tr>
        </tbody>
      </table>

      <h3 class="section-heading">Lifecycle events</h3>
      <table class="table table-sm event-table">
        <thead>
          <tr>
            <th>Event</th>
            <th>When it fires</th>
            <th>Metadata highlights</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let event of eventRows">
            <th scope="row">{{ event.type }}</th>
            <td>{{ event.when }}</td>
            <td>{{ event.meta }}</td>
          </tr>
        </tbody>
      </table>

      <p class="helper">Provide <code>SESSION_TIMEOUT_CONFIG</code> early, share a <code>storageKeyPrefix</code> across tabs, and plug analytics or logout flows into <code>SESSION_TIMEOUT_HOOKS</code> when <code>Expired</code> fires.</p>
    </div>
  </article>

  <article id="recipes" class="card docs-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title">5. Recipes & Integration Guides</h2>

      <h3 class="section-heading">UI patterns</h3>
      <div class="recipe-grid">
        <div class="recipe-card" *ngFor="let recipe of uiPatterns">
          <h4>{{ recipe.title }}</h4>
          <p>{{ recipe.description }}</p>
        </div>
      </div>

      <h3 class="section-heading">Cross-tab & multi-device</h3>
      <ul class="list-bullet">
        <li *ngFor="let tip of crossTabTips">{{ tip }}</li>
      </ul>

      <h3 class="section-heading">HTTP & server coordination</h3>
      <ul class="list-bullet">
        <li *ngFor="let tip of httpTips">{{ tip }}</li>
      </ul>

      <h3 class="section-heading">Custom activity & instrumentation</h3>
      <ul class="list-bullet">
        <li *ngFor="let tip of customActivityTips">{{ tip }}</li>
      </ul>

      <h3 class="section-heading">Maintainer scripts</h3>
      <ul class="script-list">
        <li *ngFor="let script of scripts">
          <code>{{ script.command }}</code>
          <span>{{ script.description }}</span>
        </li>
      </ul>

      <h3 class="section-heading">Manual validation</h3>
      <p>
        Review the archived distributed mode checklist in <code>docs/manual-validation/distributed-playground.md</code> if you need context on the removed feature
        before cutting a release.
      </p>
    </div>
  </article>
</section>

